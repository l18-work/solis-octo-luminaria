1-5-1-13
##5月1日
<!-- 13 -->

　動画のサイトを作ろう。仮タイトルsuichu（雫さんにちなんで）ｗ
　ちょっとURLが長いけど今のところはべつにいいでしょう。（suichu.l18.workにまでは昇格する予定だけど、ちゃんとした個別のドメインがいいなら興味のあるかたがやってください。サーバも自分で立ててください。・・・できれば固定IPを買ってね。）
　甘いものがあると元気が出る。でも毎日小梅アメを買ってると二週間で破産する計算になる・・・。飴が欲しい。
　司馬遼太郎は書斎の机の引き出しにいつも飴を入れていたそうです。
　「流華は飴だけではなかった」
　中原中也は引き出しに赤ちゃんのおもちゃを入れていたって。私も買って持っていた。・・・作家の引き出しにエロ本が入ってたらイヤでしょ？　ガラガラとかお人形をみて子供の頃を思い出しながら書いてたんだ。
　私、<a href="https://www.youtube.com/watch?v=AwfhX1REZ50">極彩色</a>が理想なんです。この植物が伸びていったり蝶が飛んだりする動画を書きたいのね。（しいなりんごの耳かきのショートムービーの最初に少しだけそういうのがある。あれは短すぎて残念だった。）こういうシルエットはとりあえずSVGですね〜。
　波形ビジュアライズはベル様の鬼謀だったようですが・・・
　「今でも鬼謀し続けている！！」
　じゃあメイキングを公開すべきw?？　理屈は・・・難しいけど実装は簡単です。ループを二重にして全フレームの可聴域を掻爬するんです。本当に（走破じゃなく）掻爬という感じです。Existential quantificationとUniversal quantification（ウィキペディアで調べてねw）の間には無限の違いがあるでしょ？　一個だけサンプルするんじゃなくて、<b>全音域</b>を調べるんです。FFTでね。（英語圏ではFFTと呼び習わされてるけど、フーリエ級数です。フーリエがフランス人であり、フランス人の名前を記念した用語であることにアメリカ人は耐えられない。だからFFTと略号で呼ばれているけど、適切な言葉ではありません。解析や生成のときもFFTではおかしい。）
　フーリエ解析について言葉で調べると、「難しそう」、「本当にこうなるの？」と思うわけだけど、実際にやってみるとああなるんです！！　三角関数はすごいｗ
　で、お嬢様のご希望はニコ動みたいな流れるコメントの実装らしい。・・・技術的にはすぐに出来ますが、コメントを書いた人を特定すべきかしら？　（しないとその人が消したり編集したりできなくなる。）しかも私達八人しかいないから量的に寂しいコメント機能になると思うよ。
　「やろうと思えば出来ることがわかればいいでしょうｗ」
　つまり実力を見せろと？
　Reolの動画みたいに文字が人物のいる世界（舞台のカーテンとか壁や道路とか）にも流れると文学的で面白い。メタフィクション。
　・・・むしろ「スクリプティング」という言葉からはああいう機能を連想しますよね。（スクリプティング言語は普通の人にとってはあまりそういうことに使うものではないけど。）
　「ベルちゃん、「ビジュアライゼーションが出来ない！　出来ない！」ってｗ」
　音速の壁というやつですね。分かる。・・・さすがにミュージシャンは感性が柔軟ですねーｗ
　音データはサンプルフレーム自体が小さいのが特徴。WAVのモノラルだと一バイト（ctypeでいうとfloat）です。それを一秒間に八千使う。サンプル数がめちゃくちゃ多いのに、最終的に思ったほどデータサイズは大きくはならない。だからストリームとして扱わずに、全部読み込んで縦に、というか横に操作していける。（さっきの言い方で言うと内側のループで時間軸方向に移動するコードを使えるのね。）それが最初はちょっと怖いし、目からウロコです。「人間が時間軸を支配してよいのか？」と思う。とくに音データは時間の中で生きている感じがするので、侵犯感は抜群ですｗ
　（アニメだから当然だけど）ビジュアライゼーションのレイテンシがゼロ（かマイナス）だと生命感と現実感がありますよね。鼓動のようだ。
　リズムの音は、ホワイトノイズじゃないです。ノイズはやめた。（ノイズと定義される音は実は澄んだ音で、人工的に聞こえる。）逆に音程のある音（普通に４４０Hzですｗ）をランダムに出したり消したりしている感じでこういう音になる。
　「べるちはリズムがけっこういいと感じたらしいｗ」
　叩いてるのは機械です！！　全部ミリ秒単位で同じ間隔でし。

　プログラミングで使う関数（function）の中で、数学的にthe functionと呼ばれうるのはやはり三角関数です。（日本の学校でも三角関数という言葉しか、関数という言葉が入った数学用語は学ばないのではないでしょうか？　微分関数とかもあるか・・・。あと対数関数くらい。）
　昔（七十年代くらい）には日本では「自分でデータ圧縮フォーマットを作ってみよう」という練習問題がよくあったんですね。以前のウィンドウズでは日本人しか使ってない圧縮フォーマットの拡張子があったくらい盛んだった。（<a href="https://forest.watch.impress.co.jp/library/software/lhasa/">これ</a>です。・・・Windows 95のころからあったのね。日本人作のフリーソフトをダウンロードすると必ずこれに入っていた。）
　アメリカでは何より暗号化の練習が主流らしく、日本は軍事国家ではないから暗号ではなく圧縮だったのかもしれない。（暗号化も圧縮もプログラマーから見ると同じものです。）
　でも、暗号化も圧縮も人間には意味不明なデータになってしまう。（だから「暗号化」というんですよね。）
　それに対してmp3などは、圧縮データと考えることも出来るけど、むしろ意味のあるデータになる。（ナマの音データよりずっと意味のあるデータになります。）
　だからフーリエ変換を勉強するのがいいかもしれないと今思った。（私もまだmp3の仕様は勉強していませんが〜。興味のある方がやったほうがいいでしょう？）

　絶対的な遅さを感じる。だから動画を作ると疲れます。いいパソコンが欲しい！
　ギリギリまで最適化しても遅いものは遅いだろう。ffmpegが遅いんだからパソコンが遅いんですよ・・・。

　コードがみたいというご意見が・・・
　「初心者には見せないほうがいいものもある！」
　今の動画で使ったコードはぐちゃぐちゃだし自分でもなんで動いたか分からないものがある。（何回か適当にパラメータをかえてミックスしてたらピッタリシンクしたので「これでいいや」と思って終了にしたんです。）
　だからもう消して書き換えちゃうつもりです。（同じものは二度と作れなくなるのね。）

　オシレータコードがCで１５７行。（短っ！！！　こんなものですよ？）
　困った。
　「流華は困っている・・・」
　WAVファイル入出力部分は、去年最初に紹介したチュートリアルサイトに載ってたコードをそのままちょっと改良して今も使っています。
　だから一つのファイルにソースがあるわけじゃないし、・・・だいたいFFTって数式から入るものであって、コードを見ると逆に混乱すると思うんですｗ

　まず、去年紹介したページからお借りしたソースを紹介するね。ちょっと改良してある。（お借りしたままのだとコアダンプする場合があったので。）
　<a href="https://ens.l18.work/priv/sourcecode/?file=https://luckxa.l18.work/mydiary/xxxtmpdata/wave.h">これがヘッダ</a>、そして<a href="https://ens.l18.work/priv/sourcecode/?file=https://luckxa.l18.work/mydiary/xxxtmpdata/wave.c">これが対応するソースです</a>。
　なんでコアダンプするかというと、WAVを出力するときヘッダをちゃんと書かないソフトが多いからです。ffmpegもその一つです。なんでヘッダをちゃんと書かないかというと、ほんらいPCMにはヘッダなど必要ないからです・・・。ヘッダにちゃんと書いてない場合は、ファイルサイズをstatして調べて修正してあげないとコアダンプする・・・。ヘッダの方の143~150行が私が書き加えたコードです・・・。
　これはこれだけのものなのでみんなもコピーして使うしかないねー。
　次にオシレータのソースは<a href="https://ens.l18.work/priv/sourcecode/?file=https://luckxa.l18.work/mydiary/xxxtmpdata/osc.c">こういう感じ</a>です。
　あれ・・・途中までしか出てこない・・・。このエディタを今準備しててまだ完備しておりません。
　・・・なおりました・・・。
　短いですねー。私はまったくいじらずにそのまま出してるよ。
　「流華のコードは何気にキレイだｗ」
　書いてるときは「ぐちゃぐちゃだーもう読みたくないわ〜」と思ってたんだけど、そう読みにくくもない？
　最後に波形分析のコードは<a href="https://ens.l18.work/priv/sourcecode/?file=https://luckxa.l18.work/mydiary/xxxtmpdata/wave_dump.c">これ</a>です。これはgnuplotで一枚だけグラフを出力するコードが去年紹介したページにあったんですけど、それをコメントアウトしてそのまま使っているんです。生々しい・・・。
　オシレータの入力も分析の出力も日本ゆかりのcsvで行っております。（ソニーもcsvを使っているんです。それを見つけたときうれしくなった。最近は世界的にも（ソニーの影響か）CSVを使う人が増えているような気がする。）
　オシレータの入力はまず音名でOpenOffice CalcでCSVを作って、それをパイソンに通して音名を周波数に変換して、それをこのCのコードに与えています。
　「よっしゃ。その部分はあとだｗ」
　その部分がいちばん読みやすいし音楽的だと思うんですが・・・厳しいですねー。
　私はいまでもこんな他人のコードをばーっと見せられたら困りますよ？
　私が使っているgdfという略号は、Gain, Duration, Frequencyのことです。音量、音の長さ、周波数ですね・・・。音名から周波数への変換は機械的に<a href="http://www.sengpielaudio.com/calculator-notenames.htm">この表</a>を見て変換表を作った。（その部分は計算していない。ちょっととっさに計算式を思いつけなかったし、量的に数十個程度なので丸写ししました。）
　令和そうそう大変なことになりました・・・。
　オシレータ（osc.c）の77~86行が（奇しくも七のゾロ目ですが）音波を作ってる部分です。最初は７７行目だけだった。それだけでも普通に音らしい音になるんです。でも低音が聞こえなくなるのと、音色がもっとオルガンっぽいほうがいいと思ったので倍音層を増やしました。
　７９・８０行が一オクターブ上、８１・８２行が五度（ドミナントとサブドミナントの音程）、そして８３・８４行はちょっと離れた音です。５の倍数が入ると代表的なのは長三度（ドミソのミ）が出せるようになる。この音は中世にDiabolus in Musicaと呼ばれていたもので、本来は協和音程とは考えられていなかったそうです。Diabolusは間に（dia）投げ入れる(bol)というギリシャ語の数学用語なんですが、キリスト教で「悪魔」という意味で使われていたから、Diabolus in Musicaを「音楽の中にひそむ悪魔の音程」と早とちりする人も多い。（ミュージシャンは語学も数学もバカにしている場合が多いので。）たとえばブーレーズはそのように早とちりしていた。（ブーレーズはすごい人だと思われていますが、音楽王国のドイツがナチスによるワーグナー宣伝で沈没していたときに現れたから脚光を浴びただけです。彼は戦時中、ドイツに占領されていた時期に運良く？ドイツ系の音楽教育を受けた。だから彼は若い頃には完全なナチだったんです。ナチスが敗れたとき、彼は混乱して「シェーンベルクは劣等人種のユダヤ人だ。シェーンベルクは死んだ！」という論文を書いている。）
　ブーレーズは電子音楽をフランスで政策的に資金援助しようとしていろんな活動をしています。ブーレーズがこだわっていたのが今で言えば「リアルタイム」ということ。つまり当時はコマンドラインのソフトしかなかったので、もっと直観的にその場で音をだせるソフトが欲しい、と言って色々文章を書いている。
　所詮は指揮者。ブーレーズはシェーンベルクやヴェーベルンに匹敵するミュージシャンではないですね・・・。
　「流華が片岡雪子との間で一番盛り上がってたのがこの時期の音楽の話ですねー」
　あんなキレイな女の人が現代音楽のCDを持ってきたら私だって興奮するさ。（ドイツ人でも興奮すると思うよ。）
　さらにちょっと遠い１１の倍数を軽く響かせて、「だいたいリアルな音色に聞こえるかな」と思って満足した。（これ以上リアリズムを追求するなら、周波数だけじゃなくエンヴェロープもいじるべきだし、アタック部分と残響部分に別の音処理を与えるべきですよね〜。）

　オシレータもシーケンサも色々存在する。フリーウェアのGUIもいっぱいあるし、API（プログラマがプログラムの中から使えるソフトのことです）もいっぱいあります。でも私の経験から言うと、自分で数式を理解して自分でソースを書いたことが一度はないと使えないようです。（GUIや専門用語で説明が表示してあっても意味がわからない。）たぶんアニメや３Dもそうだと思うのね。
　セリーという概念はこのフーリエ級数から来ている。（ある数列を単純に前から足し合わせた数列をセリーと言います。音楽用語ではセリーとフランス語で発音。英語ではシリーズと読む。この言葉はもともと中国という意味であり、中国はもともとは絹という言葉で言い表されていた。つまり絹の糸という意味ね、もともとは。）セリーもいくら数学の本を読んでもなかなか理解できない。やはり音楽から直観的に理解するしかないものがあるかもしれない。。。

　<a href="https://www.youtube.com/watch?v=xSOcroj1hbo">タバコを吸う</a>って大事なことだと思うんですよね〜。
　そう思いませんか?
　何事もなにか意味がある。

　ああ、そうです。wave.cの中で、ファイル出力以外にplayにパイプもするようになっている。ここも本来はコメントアウトしとくべきでしたね・・・。作業中はその場で音が聞きたいのでこのコードを付け加えてやっていた。playはsoxというパッケージに入っているのでaptでインストールしよう。
　「流華がずっと使ってた大事なパッケージねｗ」
　私はこれの使い方しか知らない。ドイツ人らしくmanページが詳細で丁寧なのが魅力ですね・・・使いやすい。ちなみにogg/vorbisというファイルタイプはこのsoxから出てきたものです。（これくらいの規模のプロジェクトをやっていると自然発生的に自前のファイルタイプも作られて来るものなんですよね。）
　今、soxは必ず必要なパッケージではないですが、ogg/vorbisを記念して親しんでみるのも一興かもしれません。
　「少なくとも流華が何年も愛用したソフトですからね・・・ｗ」
　コマンドラインから使えるのがplayとrec（読んで字のごとしで、使い方は説明不要です）、あとsoxi。でも開発者パッケージをインストールすると使えるAPIもあって、それも使いやすいです。
　水中のテーマは楽譜が良かったね。
　「バッハスケールｗ」
　バッハが使ってる音域とほぼ一致する。鍵盤楽器ではベストな音域です。（ピアノの八十八鍵全部は使いません。ピアノの左右いちばん端っこの音は楽音というより効果音ですよね・・・。でも、CASIOの安物のキーボードなどでは鍵盤の数が足らなくてバッハのフーガは弾けない。）
　水中のテーマの楽譜はアレンジがドイツ音楽風です。何かの陰謀を感じる・・・。これはオルガンやピアノで弾いても練習になるでしょうね。

　やっぱり日本と言えばゲームとアニメ、東アジアと言えば漢字と複雑なフォントということで、どう考えても強制的にｗ、SVGや2Dゲームを極めることが期待されている！！
　「強制なんてものは神々の世界にはないはずだが」
　・・・。
　逆に3Dだけやることが強制されてたら退屈したかもしれないけど、・・・2Dの画像を仕上げるときも3Dが必要になることはある。（空間処理。影やハイライトだけでなく、鏡面への環境の映り込みなどを作る場合は3Dを使ったほうが早いだろう。）

　エディタがちょっとマシになりました。
　「流華が作ったわけじゃない！！」
　最初アリスたんにSVGの書き方をレクチャーしようとしてたときに探してたらAce（李なしのAliceたんｗ）というウェブ用のエディタAPIを見つけたので使わせてもらってます。（こんなの自分で書けって言われたら大変なことになる。・・・シンタックス一種類だけなら書けないことはないけど、このAceは古今東西のほとんどの言語を網羅しているすぐれものだ・・・。）
　<a href="https://ens.l18.work/priv/sourcecode/test.php?file=https://luckxa.l18.work/mydiary/xxxtmpdata/sakura.svg">こないだの桜のSVG</a>も見やすくなったぞ〜。（メニューの再生ボタンをクリックしてねｗ）
　たとえば、十五行目のdisplay="none"をdisplay="block"に変えて試してみてください。こういう方眼はよく使う。
　「これは流華のやり方ですｗ」
　私のやり方が見本としてSVGに使われていた。方眼で確かめながら作って、完成したら方眼部分のコードを消すわけね。
　このファイルは本来このLayer_2は必要ないわけですね。でもこういう作ったときに使ったメタデータやコメントをそのまま残して配布することは多いです。SVGでは例外的だけど、Cなどのソースコードではそうすることがほとんど常識になっている。
　このエディタはデバッグもしてくれる！！
　まあ・・・いろんなSVGなどのURLを検索してここに貼り付けてみると参考になるかもしれない。（w3schoolsのTryit Editorをつかってもいいですけどね。）

　コードは読むより書くほうが簡単です。他人のコードを読むのはすごい骨が折れる。
　コードを書き始めるにはとりあえずCを最後まで勉強する必要がある。大学生と同じ勢いで同じ勉強時間をとっていれば半年くらいでなんとか自分のコードをコンパイルすることは出来るようになる。
　私も今になって初めてオシレータなども作れるようになった。最初にやりたかったのは私もやはりサウンドプログラミングだったんですが、ずっと無理だと思っていた。大きな壁だった。
　フーリエが何をした人なのかとか私もウィキペディアをよんでもちっともわかりません。
　でも、フーリエが言ったと言われる通りに三角関数を加算してみたら、本当に和音になるんです。積算したら複雑な波形の中でどの音が含まれているかを抽出出来るんです。
　そのコードが全然複雑ではなくて、言語とは言っても英語みたいに難しい長い文章を読み書きする必要はなく、たった数十行で成立するということが分かっていただけていたら嬉しいかぎりでございます。
　私も、というか私はとくに、小説みたいに長いコードを書かなきゃいけないという強迫観念はずっとありました。
　「ずばり流華は素人なんですか？って」
　どうでしょうね？　自分では素人だと思ってるけどｗ
　素人のことをアマチュアと言います。ウェブが台頭した時期にある音楽記者が「ウェブが、グーグルが、ウィキペディアが、いかに世界の文化を破壊するアマチュア主義を布教しているか」というバッシング本を書いてベストセラーになった。私も読みました。（<a href="https://books.google.co.jp/books/about/The_Cult_of_the_Amateur.html?id=Z59TDBx1U2UC&redir_esc=y">この本です</a>。）このAmateurはフランス語ね。この記者はウェブの国際性に是があることを認めつつ、それに悔し紛れの反逆をしている。
　Amateurはフランス語では愛好者のこと。たとえばクラシック愛好会のメンバーとかをamateurと言います。ラテン語ではamatorは単に愛人、恋人という意味です。
　私は素人でありたい、アマチュアでありたいと思うけど。
　「流華が東大の大学院に提出した自己紹介で自分を「一人の物語のアマチュア」と書いた」
　フランス語では「物語好き」という意味になるんです。
　研究者とかプロの書き手とかではなく、愛で動いてるんだと言うことを言いたかった。
　プロとアマがいてプロが偉い、何がなんでも偉いという考え方は英語圏から出てきたものです。たぶんアダム・スミス主義の一種ですね・・・。音楽はとくにそうじゃないですか？　タダの変人やガキでもプロなら崇められる。
　人間の人生は短いからとりあえずプロになって安定した地位にたどり着きたいというのはあった。
　もし無限に時間があったら・・・アマチュアのまま頑張る方がもしかしたらよかったのではないでしょうか？　音楽にしろ大学人にしろ。生き急いでみんなを道連れにしても疲れるだけではないでしょうか。
　私は素人だし、素人のコードだと思って穴を探しながら読んでくださるといいと思って・・・そういうことが出来るはずだから自分のコードを見てもらうのがいいと思った。コンパイラもソースエディタも私が作ったものではない。（エディタは一瞬自分で作ろうかとも思ったんですけど、この場合は既存のライブラリを使った方がよいと判断して使った。今これを自分で作り始めたら色んなことのリズムが狂ってしまうと思ってｗ　今存在する言語のエディタを真面目に作るということは、自分の未来を否定する行為になるんじゃないかな？　私は新しい言語が作りたいし、新しいコンパイラが作りたいのね。）

